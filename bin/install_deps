#!/usr/bin/env bash

# Clone repository
# git clone https://github.com/danielsuo/turkey --recursive

# Basic setup
sudo apt-get update
sudo apt-get install -y \
  git \
  build-essential \
  cmake \
  autoconf \
  automake \
  libtool \
  uuid-dev \
  pkg-config \
  libboost-all-dev


# Cgroup
sudo apt-get install -y libcgroup-dev cgroup-tools

# Monitoring
sudo apt-get install -y htop iotop sysstat linux-tools-common linux-tools-generic

# Install bcc
echo "deb [trusted=yes] https://repo.iovisor.org/apt/xenial xenial-nightly main" | sudo tee /etc/apt/sources.list.d/iovisor.list
sudo apt-get update
sudo apt-get install bcc-tools
echo 'PATH=/usr/share/bcc/tools:$PATH' >> ~/.bashrc

# Add docker to apt
sudo apt-get -y --no-install-recommends install apt-transport-https ca-certificates curl software-properties-common
curl -fsSL https://apt.dockerproject.org/gpg | sudo apt-key add -
apt-key fingerprint 58118E89F3A912897C070ADBF76221572C52609D
sudo add-apt-repository \
       "deb https://apt.dockerproject.org/repo/ \
       ubuntu-$(lsb_release -cs) \
       main"
sudo apt-get update
sudo apt-get install -y \
  docker-engine

# Install curl
sudo apt-get install -y libcurl4-openssl-dev

# Set up watchman (for remote development)
curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -
sudo apt-get install -y nodejs automake autoconf python-dev libtool pkg-config
sudo npm install -g nuclide

git clone https://github.com/facebook/watchman.git vendor/watchman
pushd vendor/watchman
git checkout v4.8.0-rc1  # the latest stable release
./autogen.sh
./configure --enable-lenient
make
sudo make install
popd

echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p

echo "export NVM_DIR=\"$HOME/.nvm\"" >> ~/.bashrc
echo "[ -s \"$NVM_DIR/nvm.sh\" ] && . \"$NVM_DIR/nvm.sh\"" >> ~/.bashrc

# Perf dependencies
sudo apt-get install -y \
  flex \
  bison \
  libelf-dev \
  libaudit-dev \
  libdw-dev \
  libunwind* \
  python-dev \
  binutils-dev \
  libnuma-dev \
  libgtk2.0-dev \
  libbfd-dev \
  libelf1 \
  libperl-dev \
  libnuma-dev \
  libslang2 libslang2-dev \
  libunwind8 libunwind8-dev \
  binutils-multiarch-dev \
  elfutils \
  libiberty-dev \
  libssl-dev \
  liblzma-dev \
  systemtap-sdt-dev

# git clone https://github.com/torvalds/linux
# pushd linux/tools/perf
# make
# sudo make install
# popd

# PARSEC dependencies
sudo apt-get update && sudo apt-get install -y \
  build-essential \
  wget \
  m4 \
  libx11-dev \
  libxtst-dev \
  libxt-dev \
  libxmu-headers \
  libxmu-dev \
  libtbb-dev \
  pkg-config \
  gettext \
  x11proto-xext-dev \
  libglu1-mesa-dev
